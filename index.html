<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Voiceflow + Push-to-Talk (Widget-Next)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="margin:0;font-family:sans-serif;background:#0f172a;color:#eee;">
  <h1 style="padding:10px;">Voiceflow Chat (Widget-Next + Push-to-Talk)</h1>
  <div id="vf-chat"></div>

  <!-- Widget-Next bundle -->
  <script>
    (function(d, t) {
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
      v.onload = function() {
        window.voiceflow.chat.load({
          verify: { projectID: '68d9f429d1409c6c304d5485' },
          url: 'https://general-runtime.voiceflow.com',
          versionID: '68d9f429d1409c6c304d5486',
          render: { mode: "embedded", target: document.getElementById("vf-chat") },
          autostart: true
        });
      };
      v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs";
      v.type = "text/javascript";
      s.parentNode.insertBefore(v, s);
    })(document, 'script');
  </script>

  <!-- Push-to-Talk (sends via API, not textbox) -->
  <script>
    (function(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) { console.warn("No Web Speech API support."); return; }
      let rec, isRec=false, text="";

      const btn=document.createElement("button");
      btn.textContent="ðŸŽ¤"; btn.style.cssText="position:fixed;right:20px;bottom:20px;width:60px;height:60px;border-radius:50%;font-size:24px;background:#2563eb;color:#fff;border:none;cursor:pointer;z-index:9999";
      document.body.appendChild(btn);

      function sendDirect(msg){
        if(window.voiceflow && window.voiceflow.chat){
          window.voiceflow.chat.send({ type:"message", payload:{ message: msg } });
        }
      }

      function start(){ if(isRec) return; isRec=true;text="";rec=new SR();rec.lang="en-AU";rec.interimResults=true;rec.continuous=true;
        rec.onresult=e=>{for(let i=e.resultIndex;i<e.results.length;i++){if(e.results[i].isFinal) text+=e.results[i][0].transcript+" ";}};
        rec.onend=()=>{if(isRec) stop();}; rec.start(); btn.style.background="#ef4444";}
      function stop(){ if(!isRec) return; isRec=false;rec.stop(); if(text.trim()) sendDirect(text.trim()); btn.style.background="#2563eb"; }

      window.addEventListener("keydown",e=>{ if(e.code==="Space"&&!e.repeat){ e.preventDefault(); start(); }});
      window.addEventListener("keyup",e=>{ if(e.code==="Space"){ e.preventDefault(); stop(); }});
      btn.onclick=()=> isRec?stop():start();
    })();
  </script>
</body>
</html>
